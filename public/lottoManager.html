<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>복권 관리자 페이지</title>
  <!-- materialize.css 포함 -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
  <!-- SyntaxHighlighter 포함 -->
  <link href="css/shCore.css" rel="stylesheet" type="text/css" />
  <!-- <link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" /> -->
  <link href="css/shThemeMidnight.css" rel="stylesheet" type="text/css" />
  <style>
    #Summary {font-size: 1.2em; }
    #Summary ul{ margin-left: 32px; }
    #Summary ul li{ list-style: disc; }
    .hint{ border-left: 0.3em #ddd solid; padding-left: 1em; color: #777;}
    .code_block{ background-color: #eee; padding: 5px; }
  </style>

</head>

<body>
  <!-- 상단 네비게이션 -->
  <nav class="indigo">
    <div class="nav-wrapper">
      <div class="container">
        <a href="/" class="breadcrumb">메인 관리자</a>
        <a href="/lottoManager.html" class="breadcrumb">복권 관리자</a>
      </div>
    </div>
  </nav>

  <div class="container center"><br><br>

  </div>

  <!-- 내용영역 -->
  <div class="container" id="CONTENTS">
    <!-- 핵심 -->
    <h3 class="indigo-text center">:+: 복권 번호 :+:</h3>
    <div class="row center">
      <button id="BTN_SELECT_LUCKY" type="button" class="btn white indigo-text">당첨 번호 추첨</button>
      <button id="BTN_TEST_CREATE" type="button" class="btn white indigo-text">번호 생성</button>
    </div>

    <div class="row z-depth-1">
      <div class="col l12 m12 s12">
        <p>
        당첨 번호 :
          <!-- TODO 4. 상태 보기용 span 확인-->
           <span id="LOTTO_GROUP" class="blue-text">추첨 버튼을 눌러주세요</span>
         </p>
      </div>
    </div>

  </div>

  <section id="page1" data-role="page">
  		<div class="content" data-role="content">
  			<ol data-role="listview">
  				<li id = "LOTTO_0">공무원</li>
  				<li id = "LOTTO_1">서비스업</li>
          <li id = "LOTTO_2">공무원</li>
          <li id = "LOTTO_3">공무원</li>
          <li id = "LOTTO_4">공무원</li>
          <li id = "LOTTO_5">공무원</li>
          <li id = "LOTTO_6">공무원</li>
          <li id = "LOTTO_7">공무원</li>
          <li id = "LOTTO_8">공무원</li>
  			</ol>
  		</div>
  	</section>


  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js">
  </script>
  <script type="text/javascript" src="./js/materialize.min.js"></script>
  <script type="text/javascript" src="./js/shCore.js"></script>
  <script type="text/javascript" src="./js/shAutoloader.js"></script>
  <script type="text/javascript">
  // SyntaxHighlighter 설정 (http://alexgorbatchev.com/SyntaxHighlighter)
    SyntaxHighlighter.autoloader(
      'bash shell             ./js/shBrushBash.js',
      'js jscript javascript  ./js/shBrushJScript.js'
    );
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.all()
  </script>

  <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase-database.js"></script>
  <script src="/fireinit.js"></script>

  <script type="text/javascript">


    $("#PROGRESS").show();

      var Lottocount;
      firebase.database().ref('/lottocount').once('value', function(snapshot) {
        var message = snapshot.val();
        Lottocount = message;
        console.log(Lottocount);
      });

	  var LottoRefNumber;
	  firebase.database().ref('/lottoRefNumber').once('value', function(snapshot) {
        var message = snapshot.val();
        LottoRefNumber = message;
        console.log(LottoRefNumber);
      });

    var arrLottoUser = new Array();

      var dbTestRef = firebase.database().ref('/lotto')
      dbTestRef.on('child_added', function(data){
      	//console.log(data.val().Number, 'key: ', data.key)
        arrLottoUser[data.val().User] = data.val().Number;
        console.log(arrLottoUser[0]);
        $("#LOTTO_"+data.val().User).text(data.val().Number);
      })


    $("#BTN_SELECT_LUCKY").click(function() {
      var result = Math.floor(Math.random() * Lottocount) + 1;
    //  document.write(result);
      $("#LOTTO_GROUP").text(arrLottoUser[result]);
      	console.log(result);
		firebase.database().ref('/lottoLuckyNumber').set(arrLottoUser[result])

	  var LottoRandNumber = Math.floor(Math.random() * 100) + 1;
	   firebase.database().ref('/lottoRefNumber').set(LottoRandNumber)
    });

    $("#BTN_TEST_CREATE").click(function() {
      var result = LottoRefNumber * Lottocount;
    //  document.write(result);

    firebase.database().ref('/lotto/' + Lottocount).set({"User": Lottocount, "Number": result})
    Lottocount++;
    firebase.database().ref('/lottocount').set(Lottocount)
    });

</script>

</body>

</html>
